# LoginBonus

Minecraft Bukkitプラグインで、ログインボーナスシステムを実装します。プレイヤーが累積ログイン時間を蓄積し、設定された目標時間に達すると報酬を与えます。

## 機能

### コア機能
- **累積ログイン時間追跡**: 各プレイヤーの累積ログイン時間を分単位で追跡します。ログイン中にリアルタイムで更新されます。
- **報酬システム**: プレイヤーが設定された目標プレイ時間に達すると、自動で報酬を付与します。インベントリが満杯の場合は地面にドロップされます。
- **ボスバーディスプレイ**: 報酬が利用可能になるまでの残り時間をリアルタイムでカスタマイズ可能なボスバーで表示します。目標達成で自動的に非表示になります。
- **サーバー停止時のデータ保存**: サーバー停止時にオンラインのプレイヤーのセッション時間を自動保存します。

### ストリークシステム
- **デイリーストリーク**: 報酬請求の連続日数を追跡します。
- **ストリークボーナス**: ストリークを維持するための追加報酬（基本報酬にストリーク分加算）。
- **特別ストリーク報酬**: 特定のストリーク日数（例: 7日目、30日目）に対する設定可能な特別報酬。
- **特別倍数報酬**: ストリーク日数の倍数（例: 5日ごと、10日ごと）に対する報酬。

### ストレージと同期
- **複数のストレージオプション**: YAMLファイル、SQLiteデータベース、MySQLデータベースから選択可能。
- **プレイヤーデータ同期**: MySQLストレージを使用する場合、複数のサーバー間でプレイヤーデータを同期。`/rewardsync` コマンドで手動同期、またはプレイヤーログイン時に自動同期。

### 設定
- **設定可能な報酬**: `config.yml`で報酬アイテム、数量、メッセージを定義します。
- **メッセージカスタマイズ**: `message.yml`で全てのプラグインメッセージをカスタマイズします。
- **ボスバーカスタマイズ**: ボスバーの色、スタイル、タイトルを設定します。
- **時間設定**: 目標プレイ時間やその他の時間関連オプションを設定します。
- **ストレージタイプ**: `config.yml`でデータストレージをYAML、SQLite、またはMySQLから選択できます。

## コマンド

### プレイヤーコマンド
- `/rewardstreak`  
  現在のストリーク日数を確認します。

### 管理者コマンド（OP権限が必要）
- `/rewardreload`  
  サーバーを再起動せずに設定ファイル（`config.yml`、`playerdata.yml`、`message.yml`）をリロードします。
- `/rewardforcegive <player>`  
  指定されたプレイヤーにプレイ時間に関係なく強制的に報酬を付与します。テストや手動報酬に便利です。
- `/rewardsetstreak <player> <days>`  
  指定されたプレイヤーのストリークカウントを指定された日数に設定します。最後のストリーク日付はリセットしません。
- `/rewardresetplaytime <player>`  
  指定されたプレイヤーの累積プレイ時間を0にリセットし、ボスバーを再開始します。
- `/rewardsync`  
  MySQLストレージを使用している場合、プレイヤーデータをデータベースから同期します。複数のサーバー間でデータを更新する際に使用。

## 設定ファイル

### config.yml
`plugins/LoginBonus/config.yml`にあります。報酬、ボスバー設定、その他のプラグインオプションを定義します。

例の構造:
```yaml
# ================================
# ログイン報酬プラグイン設定ファイル
# ================================
# このファイルでログイン報酬の動作をカスタマイズできます。
# 変更後はサーバーを再起動するか、/rewardreload コマンドでリロードしてください。

# ================================
# ストレージ設定
# ================================
# プレイヤーデータの保存方法
# yaml: YAMLファイルに保存（デフォルト）
# sqlite: SQLiteデータベースに保存
# mysql: MySQLデータベースに保存（マルチサーバー対応）
storage-type: yaml

# MySQL設定（storage-type: mysql の場合のみ使用）
mysql:
  host: localhost
  port: 3306
  database: loginbonus
  username: root
  password: password
  # 接続プール設定
  connection-pool:
    maximum-pool-size: 10
    minimum-idle: 2
    connection-timeout: 30000

# ================================
# 基本設定
# ================================
# 報酬を受け取るための累積ログイン時間（分単位）
# 例: 30 → 30分ログインで報酬
reward-time: 1

# 報酬アイテムのリスト
# 各アイテムのMaterial名と個数を指定
# ストリーク機能が有効の場合、個数がストリーク分加算されます
reward-items:
  - item: DIAMOND
    amount: 1

# ================================
# ストリーク設定
# ================================
# ストリーク機能を有効にするかどうか
# true: 連続ログインで報酬が増える / false: 無効
streak-enabled: true

# ================================
# 特殊ストリーク報酬設定（個別日数）
# ================================
# 特殊ストリーク報酬を有効にするかどうか
# true: 指定した個別日数での報酬を支給 / false: 無効
special_streak_rewards:
  enabled: true
  rewards:
    '7':
      items:
        - type: EMERALD
          amount: 7
      message: "&b7日連続ログイン！エメラルド7個プレゼント！"
    '30':
      items:
        - type: NETHERITE_INGOT
          amount: 1
      message: "&d30日連続ログイン！ネザライトインゴット1個プレゼント！"

# ================================
# 特殊倍数ストリーク報酬設定（倍数日数）
# ================================
# 特殊倍数ストリーク報酬を有効にするかどうか
# true: 指定した倍数日数での報酬を支給 / false: 無効
special_multiple_rewards:
  enabled: true
  multiples:
    '5':
      items:
        - type: GOLD_INGOT
          amount: 2
      message: "&e%days%日連続ログイン！ゴールドインゴット2個プレゼント！"
    '10':
      items:
        - type: GOLD_INGOT
          amount: 4
      message: "&e%days%日連続ログイン！ゴールドインゴット4個プレゼント！"

# ================================
# ボスバー設定
# ================================
# ボスバーのタイトル
# %remaining% で残り時間が表示されます
# Minecraftの装飾コードを使用可能（例: &a = 緑色）
boss-bar-title: "&a報酬まで残り: %remaining%"

# ボスバーの色
# BarColorの値: BLUE, GREEN, PINK, PURPLE, RED, WHITE, YELLOW
boss-bar-color: BLUE

# ボスバーのスタイル
# BarStyleの値: SOLID, SEGMENTED_6, SEGMENTED_10, SEGMENTED_12, SEGMENTED_20
boss-bar-style: SOLID
```

### message.yml
`plugins/LoginBonus/message.yml`にあります。プラグインメッセージをカスタマイズします。

例:
```yaml
# ================================
# メッセージ設定ファイル
# ================================
# このファイルでプラグインのメッセージをカスタマイズできます。
# Minecraftの装飾コードを使用可能（例: &e = 黄色、&c = 赤色）。

# ================================
# 報酬関連メッセージ
# ================================
# 報酬を受け取った時のメッセージ
reward-message: "&e報酬を受け取りました！"

# 既に報酬を受け取っている場合のメッセージ
already-claimed-message: "&c今日は既に報酬を受け取っています。"

# 報酬を受け取る条件を満たしていない場合のメッセージ
not-enough-time-message: "&cまだ報酬を受け取る条件を満たしていません。"
```

### playerdata.yml / playerdata.db / MySQLテーブル
YAMLストレージの場合: `plugins/LoginBonus/playerdata.yml`にあります。プレイヤーデータ（累積時間、ストリーク、最後の報酬）を保存します。手動で編集しないでください。

SQLiteストレージの場合: `plugins/LoginBonus/playerdata.db`にあります。データベース形式でプレイヤーデータを保存します。手動編集は推奨されません。

MySQLストレージの場合: 指定されたMySQLデータベースに`playerdata`テーブルが作成され、プレイヤーデータが保存されます。テーブルスキーマはUUID（主キー）、cumulative（累積時間）、lastReward（最後の報酬日）、streak（ストリーク）、lastSync（最終同期タイムスタンプ）です。

## インストール

1. プラグインのJARファイルをダウンロードします。
2. JARをサーバーの`plugins/`フォルダに配置します。
3. サーバーを再起動するか、`/reload`を使用します（本番環境では推奨されません）。
4. 必要に応じてconfig.ymlとmessage.ymlを設定します。
5. SQLiteストレージを使用する場合、SQLite JDBCドライバがサーバーに利用可能であることを確認してください（プラグインにバンドルされています）。
6. MySQLストレージを使用する場合、MySQLサーバーをセットアップし、config.ymlに接続情報を設定してください。MySQL JDBCドライバが利用可能であることを確認（プラグインにバンドルされています）。
7. 設定を変更した場合、`/rewardreload` コマンドを使用するか、再びサーバーを再起動します。

## パーミッション

- 報酬を受け取る為に必要な権限はありません。
- コマンドは、`/rewardstreak`コマンドのみ権限が付与されていないプレイヤーでも実行できます。
- `/rewardstreak`以外のコマンドを実行するためには、`OP権限` または `lgb01.admin` が必要です。

## 互換性

- **Minecraftバージョン**: 1.19.4 (Spigot API 1.19.4-R0.1-SNAPSHOT)
- **Javaバージョン**: 17
- **Bukkit/Spigot/Paper**: 標準的なBukkit実装と互換。
- **ストレージ**: YAML、SQLite、またはMySQLデータベース。

## 開発

- **ソースコード**: GitHubで利用可能。
- **ビルド**: Gradleを使用してプロジェクトをビルドします。
- **依存関係**: Spigot APIが必要です。SQLiteストレージを使用する場合、SQLite JDBCドライバが含まれます。MySQLストレージを使用する場合、MySQL JDBCドライバが含まれます。

## ライセンス

このプラグインはMITライセンスで公開されています。

## サポート

問題や質問については、GitHubリポジトリでissueを作成してください。

## 貢献者
このプラグインの開発では、GitHub Copilotがコード生成とドキュメント支援を提供しました。

